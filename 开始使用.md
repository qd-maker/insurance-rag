# 🎉 RAG 保险查询系统 - 开始使用

**项目已完全就绪！** 🚀

---

## 📍 项目位置

```
E:\code\cursor\insurance-rag
```

---

## ⚡ 5 分钟快速开始

### 1️⃣ 配置环境变量（2 分钟）

在项目根目录创建 `.env.local` 文件，复制以下内容并填入你的密钥：

```bash
# Supabase 配置
NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key

# OpenAI 配置
OPENAI_API_KEY=sk-your-key
EMBEDDING_MODEL=text-embedding-3-small
GENERATION_MODEL=gpt-4o-mini
EMBEDDING_DIM=1536

# 检索参数
RAG_MATCH_COUNT=10
RAG_MATCH_THRESHOLD=0.3
```

**获取密钥：**
- 🔗 Supabase: https://supabase.com → Settings → API
- 🔗 OpenAI: https://platform.openai.com → API keys

### 2️⃣ 初始化数据库（1 分钟）

1. 打开 Supabase 控制台
2. 进入 **SQL Editor**
3. 新建 Query
4. 复制 `supabase/sql/001_rag_schema.sql` 全部内容
5. 点击 **Run** 执行

### 3️⃣ 验证系统（2 分钟）

```bash
# 安装依赖
npm install

# 运行诊断脚本
npx tsx scripts/diag.ts

# 预期输出：✅ ✨ 端到端 RAG 链路正常！
```

---

## 📚 文档导航

| 文档 | 说明 |
|------|------|
| 📖 [`QUICK_START.md`](./QUICK_START.md) | **5 分钟快速启动卡** [object Object] [`RAG_SETUP_GUIDE.md`](./RAG_SETUP_GUIDE.md) | 完整设置指南（包含故障排查） |
| 📖 [`FIXES_SUMMARY.md`](./FIXES_SUMMARY.md) | 所有修复和改进的总结 |
| 📖 [`SETUP_COMPLETE.md`](./SETUP_COMPLETE.md) | 设置完成确认 |
| 📖 [`README.md`](./README.md) | 项目概述 |

---

## 🎯 核心功能

✅ **向量检索** - 使用 pgvector 进行高效的语义相似度搜索  
✅ **AI 提取** - 使用 GPT-4o-mini 自动提取产品核心信息  
✅ **结构化输出** - 返回产品概况、保障权益、责任免除、销售话术等  
✅ **诊断工具** - 一键检查 RAG 链路的所有环节  
✅ **Fallback 机制** - 向量检索无结果时自动降级到产品名模糊匹配  

---

## 🔧 已创建的文件

### 📁 核心代码

```
✅ scripts/diag.ts                    - 诊断脚本（450 行）
✅ supabase/sql/001_rag_schema.sql    - SQL 初始化脚本（180 行）
✅ src/app/api/health/route.ts        - 健康检查端点（150 行）
✅ src/app/api/search/route.ts        - RAG 查询 API（已修复）
✅ src/app/page.tsx                   - 前端 UI（已改进）
✅ scripts/seed.ts                    - 数据插入脚本
✅ scripts/seedData.ts                - 示例数据
```

### 📚 文档

```
✅ QUICK_START.md                     - 快速启动卡
✅ RAG_SETUP_GUIDE.md                 - 完整设置指南
✅ FIXES_SUMMARY.md                   - 修复补丁总结
✅ SETUP_COMPLETE.md                  - 设置完成确认
✅ 开始使用.md                         - 本文件
✅ README.md                          - 项目概述
```

---

## 🚀 启动应用

```bash
# 1. 安装依赖
npm install

# 2. 启动开发服务器
npm run dev

# 3. 打开浏览器
# http://localhost:3000
```

---

## 🔍 诊断命令

```bash
# 运行完整诊断
npx tsx scripts/diag.ts

# 检查健康状态
curl http://localhost:3000/api/health

# 插入示例数据
npx tsx scripts/seed.ts
```

---

## ⚠️ 常见问题

### 问题：缺少 SUPABASE_SERVICE_ROLE_KEY

**解决：** 检查 `.env.local` 文件是否存在且包含该行

```bash
cat .env.local | grep SUPABASE_SERVICE_ROLE_KEY
```

### 问题：match_clauses RPC 失败

**解决：** 在 Supabase SQL Editor 中执行 `supabase/sql/001_rag_schema.sql`

### 问题：维度不匹配

**解决：** 确保 `.env.local` 中的配置正确

```bash
EMBEDDING_DIM=1536
EMBEDDING_MODEL=text-embedding-3-small
```

### 问题：检索返回空结果

**解决：** 运行数据插入脚本

```bash
npx tsx scripts/seed.ts
```

---

## 📊 系统架构

```
用户查询
    ↓
[1] 生成查询向量 (OpenAI Embedding)
    ↓
[2] 向量相似度搜索 (Supabase pgvector)
    ↓
[3] 无结果? → Fallback: 产品名模糊匹配
    ↓
[4] 构建上下文 (条款内容)
    ↓
[5] AI 提取结构化信息 (GPT-4o-mini)
    ↓
[6] 返回 JSON 结果
    ↓
前端渲染结果
```

---

## 🔐 安全性

✅ Service Role 密钥仅在服务端使用  
✅ RLS 策略限制 Anon 用户访问  
✅ 所有敏感信息存储在环境变量中  
✅ 前端无密钥泄漏  

---

## 📈 性能指标

| 指标 | 目标 |
|------|------|
| 查询延迟 | < 2 秒 |
| 向量检索 | < 100ms |
| AI 提取 | < 1.5 秒 |
| 支持数据量 | 10K+ 条款 |

---

## 📞 需要帮助？

1. 📖 查看 [`QUICK_START.md`](./QUICK_START.md) - 快速参[object Object]查看 [`RAG_SETUP_GUIDE.md`](./RAG_SETUP_GUIDE.md) - 详细指南
3. 🔍 运行诊断脚本：`npx tsx scripts/diag.ts`
4. 🌐 检查健康状态：`curl http://localhost:3000/api/health`

---

## ✅ 验收清单

完成以下步骤即可开始使用：

- [ ] 创建 `.env.local` 文件并填入密钥
- [ ] 在 Supabase 中执行 SQL 脚本
- [ ] 运行诊断脚本验证系统
- [ ] 启动开发服务器
- [ ] 打开前端 UI 并测试查询

---

## 🎉 准备就绪！

所有文件都已创建，系统已准备好使用。

**立即开始：** 👉 按照上面的"5 分钟快速开始"步骤操作

**需要详细步骤？** 👉 查看 [`QUICK_START.md`](./QUICK_START.md)

**遇到问题？** 👉 查看 [`RAG_SETUP_GUIDE.md`](./RAG_SETUP_GUIDE.md) 的故障排查章节

---

**祝你使用愉快！** 🚀

