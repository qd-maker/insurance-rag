# Insurance RAG Engine ğŸ¥

> åŸºäº RAGï¼ˆRetrieval-Augmented Generationï¼‰æŠ€æœ¯çš„ä¿é™©äº§å“çŸ¥è¯†åŠ©æ‰‹

[![Next.js](https://img.shields.io/badge/Next.js-15-black)](https://nextjs.org/)
[![Supabase](https://img.shields.io/badge/Supabase-PostgreSQL-green)](https://supabase.com/)
[![OpenAI](https://img.shields.io/badge/OpenAI-GPT--4o-blue)](https://openai.com/)

---

## ğŸ“Œ é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªé¢å‘ä¿é™©é”€å”®äººå‘˜çš„æ™ºèƒ½çŸ¥è¯†åŠ©æ‰‹ã€‚ç”¨æˆ·è¾“å…¥ä¿é™©äº§å“åç§°åï¼Œç³»ç»Ÿä»å‘é‡æ•°æ®åº“æ£€ç´¢ç›¸å…³æ¡æ¬¾ï¼Œç»“åˆ LLM ç”Ÿæˆç»“æ„åŒ–çš„äº§å“åˆ†ææŠ¥å‘Šï¼ŒåŒ…æ‹¬æ ¸å¿ƒä¿éšœã€é™¤å¤–è´£ä»»ã€é”€å”®è¯æœ¯ç­‰ã€‚

### æ ¸å¿ƒä»·å€¼
- ğŸ¯ **å‡†ç¡®æ€§**ï¼šRAG æ¶æ„ç¡®ä¿ç”Ÿæˆå†…å®¹ä¸¥æ ¼åŸºäºæ¡æ¬¾åŸæ–‡ï¼Œé¿å…å¹»è§‰
- ğŸ“ **å¯è¿½æº¯**ï¼šæ¯ä¸ªå­—æ®µéƒ½æ ‡æ³¨æ¥æºæ¡æ¬¾ IDï¼Œå¯ç‚¹å‡»æŸ¥çœ‹åŸæ–‡
- âš¡ **æ•ˆç‡æå‡**ï¼šå°†æŸ¥é˜…æ¡æ¬¾æ—¶é—´ä» 10-30 åˆ†é’Ÿç¼©çŸ­åˆ° 10-30 ç§’

---

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

| å±‚çº§ | æŠ€æœ¯ |
|------|------|
| å‰ç«¯ | Next.js 15 + React + Tailwind CSS |
| åç«¯ | Next.js API Routes (Node.js) |
| æ•°æ®åº“ | Supabase (PostgreSQL + pgvector) |
| AI | OpenAI API (Embedding + Chat) |

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å…‹éš†ä»“åº“
```bash
git clone https://github.com/qd-maker/insurance-rag.git
cd insurance-rag
npm install
```

### 2. é…ç½®ç¯å¢ƒå˜é‡
åˆ›å»º `.env.local` æ–‡ä»¶ï¼š
```bash
OPENAI_API_KEY=your_api_key
OPENAI_BASE_URL=https://api.openai.com/v1  # æˆ–ç¬¬ä¸‰æ–¹ä»£ç†
EMBEDDING_MODEL=text-embedding-ada-002
EMBEDDING_DIM=1536
GENERATION_MODEL=gpt-4o-mini
SUPABASE_URL=your_supabase_url
SUPABASE_SERVICE_ROLE_KEY=your_service_role_key
ADMIN_TOKEN=your_admin_token
```

### 3. åˆå§‹åŒ–æ•°æ®åº“
åœ¨ Supabase SQL Editor ä¸­æ‰§è¡Œï¼š
- åˆ›å»º `products` å’Œ `clauses` è¡¨
- å¯ç”¨ pgvector æ‰©å±•

### 4. å¯¼å…¥ç¤ºä¾‹æ•°æ®
```bash
npx tsx scripts/seed.ts
```

### 5. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
```bash
npm run dev
```

è®¿é—® http://localhost:3000

---

## ğŸ“Š ç³»ç»Ÿæ¶æ„

```
ç”¨æˆ·è¾“å…¥äº§å“å
      â†“
[æ‹’ç­”æ£€æµ‹] â†’ æ— æ„ä¹‰è¾“å…¥ç›´æ¥è¿”å›é”™è¯¯
      â†“
[ç¼“å­˜æ£€æŸ¥] â†’ å‘½ä¸­åˆ™ç§’è¿”å›
      â†“
[æ··åˆæ£€ç´¢]
  â”œâ”€â”€ äº§å“åç²¾ç¡®åŒ¹é…
  â””â”€â”€ è¯­ä¹‰å‘é‡æ£€ç´¢
      â†“
[LLM ç”Ÿæˆ] â†’ ç»“æ„åŒ– JSON + æ¡æ¬¾å¼•ç”¨
      â†“
[å†™å…¥ç¼“å­˜] â†’ 24å°æ—¶æœ‰æ•ˆ
      â†“
[è¿”å›å‰ç«¯] â†’ æ¸²æŸ“å¡ç‰‡ + å¼•ç”¨å¾½ç« 
```

---

## âœ¨ æ ¸å¿ƒåŠŸèƒ½

### æ™ºèƒ½æœç´¢ API
**POST /api/search**

è¾“å…¥ï¼š
```json
{ "query": "å®‰å¿ƒæ— å¿§åŒ»ç–—é™©" }
```

è¾“å‡ºï¼ˆç»“æ„åŒ– JSONï¼‰ï¼š
```json
{
  "productName": { "value": "å®‰å¿ƒæ— å¿§åŒ»ç–—é™©", "sourceClauseId": 12 },
  "overview": { "value": "ä¸€æ¬¾ç™¾ä¸‡åŒ»ç–—é™©...", "sourceClauseId": 12 },
  "coreCoverage": [...],
  "exclusions": [...],
  "targetAudience": {...},
  "salesScript": [...],
  "clauseMap": { "12": { "snippet": "æ¡æ¬¾åŸæ–‡...", "productName": "..." } }
}
```

### äº§å“ç®¡ç†
- `GET /api/products/list`ï¼šè·å–äº§å“åˆ—è¡¨
- `POST /api/products/add`ï¼šæ·»åŠ æ–°äº§å“ï¼ˆéœ€ Tokenï¼‰
- `POST /api/products/check`ï¼šæ£€æŸ¥äº§å“æ˜¯å¦å­˜åœ¨

### æ‹’ç­”ç­–ç•¥
è‡ªåŠ¨æ‹’ç»ä»¥ä¸‹è¾“å…¥ï¼š
- é•¿åº¦ < 2 å­—ç¬¦
- çº¯æ•°å­—
- çº¯ç¬¦å·
- é‡å¤å­—ç¬¦

### ç¼“å­˜ç³»ç»Ÿ
- å¯é€‰å¯ç”¨ï¼ˆ`ENABLE_SEARCH_CACHE=true`ï¼‰
- 24 å°æ—¶è¿‡æœŸ
- å½’ä¸€åŒ–æŸ¥è¯¢æ–‡æœ¬ä½œä¸ºç¼“å­˜é”®

---

## ğŸ¨ ç•Œé¢è®¾è®¡

- **æ˜Ÿåº§ç²’å­èƒŒæ™¯**ï¼šCanvas åŠ¨ç”»ï¼Œé¼ æ ‡äº¤äº’
- **Antigravity é£æ ¼**ï¼šå¤§åœ†è§’ã€ç»ç’ƒæ€ã€æ¸å˜è£…é¥°
- **å¼•ç”¨å¾½ç« **ï¼šç‚¹å‡»æŸ¥çœ‹æ¡æ¬¾åŸæ–‡
- **åŠ è½½åŠ¨ç”»**ï¼š5 æ­¥è¿›åº¦æç¤º

---

## ğŸ“ˆ è¯„ä¼°ä½“ç³»

| æŒ‡æ ‡ | æ•°å€¼ |
|------|------|
| æµ‹è¯•é›† | 30 æ¡æŸ¥è¯¢ |
| Baseline å‡†ç¡®ç‡ | 90% |
| æµ‹è¯•åˆ†ç»„ | ç²¾ç¡®å/åˆ«å/æ‹’ç­” |

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
insurance-rag/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”‚   â”œâ”€â”€ search/        # æ ¸å¿ƒæœç´¢ API
â”‚   â”‚   â”‚   â”œâ”€â”€ products/      # äº§å“ç®¡ç† API
â”‚   â”‚   â”‚   â””â”€â”€ health/        # å¥åº·æ£€æŸ¥
â”‚   â”‚   â”œâ”€â”€ admin/             # åå°ç®¡ç†é¡µé¢
â”‚   â”‚   â””â”€â”€ page.tsx           # ä¸»é¡µé¢
â”‚   â”œâ”€â”€ components/            # UI ç»„ä»¶
â”‚   â””â”€â”€ lib/                   # å·¥å…·å‡½æ•°
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ seed.ts                # æ•°æ®å¯¼å…¥
â”‚   â”œâ”€â”€ seedData.ts            # ç¤ºä¾‹äº§å“æ•°æ®
â”‚   â””â”€â”€ eval.ts                # è¯„ä¼°è„šæœ¬
â”œâ”€â”€ experience/                # å¤åˆ©ç»éªŒæ–‡æ¡£
â”‚   â”œâ”€â”€ rag_error_patterns.md
â”‚   â””â”€â”€ backend_error_patterns.md
â””â”€â”€ data/                      # æµ‹è¯•æ•°æ®
```

---

## ğŸ¯ é¡¹ç›®äº®ç‚¹

| äº®ç‚¹ | è¯´æ˜ |
|------|------|
| **RAG å¯è¿½æº¯** | æ¯ä¸ªå­—æ®µé™„å¸¦ sourceClauseId |
| **æ··åˆæ£€ç´¢** | ç²¾ç¡®åŒ¹é… + è¯­ä¹‰æ£€ç´¢ |
| **è¯„ä¼°é©±åŠ¨** | å…ˆå»º baseline å†ä¼˜åŒ– |
| **å¤åˆ©æ²‰æ·€** | experience/ è®°å½•é”™è¯¯æ¨¡å¼ |
| **ç”Ÿäº§çº§è€ƒé‡** | ç¼“å­˜ã€æ‹’ç­”ã€æ—¥å¿— |

---

## ğŸ“„ License

MIT

---

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼
