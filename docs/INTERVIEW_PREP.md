# 🎯 面试准备指南：你必须熟记的内容

## 一、30 秒自我介绍（电梯演讲）

> "我做了一个**保险产品信息提取系统**，核心痛点是销售员查条款要 10-30 分钟，我把它缩短到 10-30 秒。技术上用 **RAG + 混合检索**，亮点是**每个字段都能追溯到原条款**，防止幻觉。我还做了**评估驱动开发**，用量化指标持续监控质量。"

---

## 二、必须背诵的 5 个核心设计决策

| # | 设计决策 | 你要说的话 |
|---|---------|----------|
| 1 | **UI 约束 vs Prompt 拒答** | "我选择用下拉框约束用户输入，而不是靠 prompt 拒答。因为 prompt 拒答有三个问题：不稳定、成本高、体验差。UI 约束从根本上消除问题。" |
| 2 | **混合检索策略** | "我先做产品名精确匹配，匹配上直接取对应条款；匹配不上才降级到语义检索。这样能防止跨产品污染。" |
| 3 | **缓存失效策略** | "主动失效 + TTL 兜底。产品状态变更时清缓存，24 小时 TTL 兜底。因为保险条款更新频率低。" |
| 4 | **sourceClauseId 可追溯** | "每个字段都标注来源条款 ID，用户点击能看原文。这是 RAG 项目最关键的差异化——可追溯防幻觉。" |
| 5 | **评估驱动开发** | "我先建 baseline，改代码后跑评估对比。指标包括引用覆盖率、P95 延迟、错误率。用 CI 自动跑防回归。" |

---

## 三、必须理解的 3 个技术深度

### 1. 混合检索流程（必考）

```
用户输入 → 产品名精确匹配 → 命中? 
   ├── 是 → 只取该产品的条款
   └── 否 → 语义检索（OpenAI Embedding + pgvector）
         → 按相似度排序，取 top N
```

**你要说的话**：
> "语义检索虽然强大，但有跨产品污染风险。比如用户查'安心无忧'，语义检索可能把'平安无忧'的条款也拉进来。所以我做了**精确匹配优先**，只有匹配不上才降级。"

### 2. 缓存设计（必考）

- **缓存键**：归一化产品名（去空格、全角转半角、统一大小写）
- **存储位置**：Supabase `search_cache` 表
- **失效时机**：产品启用/禁用时主动清除 + 24h TTL

**你要说的话**：
> "缓存键不是用户原始查询，而是归一化后的产品名。这样'安心 无忧'和'安心无忧'能命中同一缓存。失效策略是主动失效 + TTL 兜底，保证最终一致性。"

### 3. Rate Limit 实现（可能考）

- **算法**：滑动窗口（5 分钟内失败 5 次 → 锁定 15 分钟）
- **存储**：内存 Map（生产环境应换 Redis）
- **安全意义**：防止暴力猜测 Admin Token

---

## 四、数字要背牢

| 指标 | 数值 | 说法 |
|------|------|------|
| 效率提升 | 10-30min → 10-30s | "效率提升 60-100 倍" |
| 引用覆盖率 | ≥90% | "90% 的字段能追溯到原条款" |
| P95 延迟 | ≤3000ms | "3 秒内返回" |
| 缓存 TTL | 24 小时 | "条款更新频率低" |
| Rate Limit | 5 次/5 分钟 | "防暴力猜测" |
| 测试集 | 30 条 | "精确/模糊/拒答三组" |

---

## 五、面试常见追问（准备好答案）

| 问题 | 你的回答思路 |
|------|-------------|
| 为什么不用 LangChain？ | "依赖重、黑盒、难调试。手写 200 行 retrieval.ts 更可控。" |
| 为什么不用 Pinecone？ | "数据量小（几百条款），Supabase pgvector 够用且一站式。" |
| 幻觉怎么处理？ | "sourceClauseId 可追溯 + 无法确定时填'条款未说明'。" |
| 怎么扩展到 10 万用户？ | "缓存换 Redis、向量库换 Pinecone、加 CDN 和限流。" |
| 这个项目你学到什么？ | "评估驱动开发——先建 baseline 再优化，用数据证明改进。" |

---

## 六、技术栈深度问答

### RAG 相关

**Q: 为什么选择 RAG 而不是微调？**
> "RAG 的优势：
> 1. **成本低**: 不需要 GPU 训练
> 2. **可解释**: 每个回答都有来源
> 3. **易更新**: 条款变化只需更新向量库
> 4. **适合小数据**: 保险条款数据量有限"

**Q: 向量检索的原理？**
> "将文本转换为高维向量（1536维），存储在 pgvector。
> 查询时计算余弦相似度，返回最相近的 top N 条款。
> 阈值设为 0.1，过滤掉相关性太低的结果。"

**Q: 如何处理长文本？**
> "条款文本按段落切分，每段独立生成向量。
> 检索时返回相关段落，在 prompt 中拼接。
> 控制总 token 不超过模型上下文窗口。"

### 工程相关

**Q: 如何保证输出结构稳定？**
> "三层保障：
> 1. **Prompt 约束**: 明确要求输出 JSON 格式
> 2. **Zod Schema**: 运行时校验输出结构
> 3. **Fallback 规则**: 无法确定时填'条款未说明'而不是编造"

**Q: 如何优化成本?**
> "当前成本主要在 OpenAI API:
> 1. **缓存**: 相同查询直接返回，节省 API 调用
> 2. **模型选择**: 使用 gpt-4o-mini 而非 gpt-4
> 3. **Prompt 优化**: 减少 token 使用
> 
> 单次查询成本约 0.01-0.02 元，可接受。"

---

## 七、面试前 Checklist

- [ ] 能 30 秒讲清项目价值
- [ ] 能画出系统架构图（用户 → 缓存 → 检索 → LLM）
- [ ] 能解释混合检索的两阶段
- [ ] 能说出 3 个设计决策及理由
- [ ] 能背出核心数字（效率提升、引用率、延迟）
- [ ] 能回答"为什么不用 X"
- [ ] 能解释 sourceClauseId 的作用
- [ ] 能说明缓存失效策略
- [ ] 能画出 Rate Limit 的滑动窗口算法

---

## 八、项目亮点总结（一句话版）

| 亮点 | 一句话 |
|------|--------|
| **产品思维** | "用 UI 约束消除拒答，比 prompt 约束更可靠" |
| **工程能力** | "评估驱动开发，用 baseline + CI 保证质量" |
| **技术深度** | "混合检索防跨产品污染，缓存保最终一致性" |
| **可追溯性** | "每字段标注 sourceClauseId，点击看原文" |
| **生产级考量** | "缓存、Rate Limit、结构化日志、审计日志" |

---

## 九、系统架构图（白板画图用）

```
┌─────────────────────────────────────────────────────────┐
│                       前端 (Next.js)                     │
│  ┌─────────────┐                                        │
│  │ 产品下拉框   │ ← 约束用户输入，消除拒答场景            │
│  └──────┬──────┘                                        │
└─────────┼───────────────────────────────────────────────┘
          │ POST /api/search
          ▼
┌─────────────────────────────────────────────────────────┐
│                    后端 API Layer                        │
│                                                         │
│  ┌──────────┐    ┌──────────┐    ┌──────────┐          │
│  │ 缓存检查  │ → │ 混合检索  │ → │ LLM 抽取  │          │
│  └────┬─────┘    └────┬─────┘    └────┬─────┘          │
│       │               │               │                 │
│   命中秒返回      精确+语义       结构化JSON              │
└───────┼───────────────┼───────────────┼─────────────────┘
        │               │               │
        ▼               ▼               ▼
┌─────────────────────────────────────────────────────────┐
│                    数据层                                │
│                                                         │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  │
│  │ search_cache │  │   clauses    │  │   products   │  │
│  │  (缓存表)     │  │ (条款+向量)  │  │  (产品表)    │  │
│  └──────────────┘  └──────────────┘  └──────────────┘  │
│                                                         │
│                    Supabase (PostgreSQL + pgvector)      │
└─────────────────────────────────────────────────────────┘
```

---

**最后提醒**：面试时保持自信，用"我选择...因为..."的句式展示决策能力。
